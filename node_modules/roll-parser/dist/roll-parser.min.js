(function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window,b.rollParser=a()}})(function(){return function b(c,d,e){function a(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof require&&require;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var f=d[h]={exports:{}};c[h][0].call(f.exports,function(b){var d=c[h][1][b];return a(d?d:b)},f,f.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof require&&require,f=0;f<e.length;f++)a(e[f]);return a}({1:[function(a,b){b.exports={Roll:a("./src/object/Roll"),WodRoll:a("./src/object/WodRoll"),Result:a("./src/object/Result"),parse:a("./src/complex/parse"),parseClassicRoll:a("./src/complex/parseClassicRoll"),parseSimpleRoll:a("./src/complex/parseSimpleRoll"),parseWodRoll:a("./src/complex/parseWodRoll"),roll:a("./src/roller").rollAny,rollClassic:a("./src/roller").rollClassic,rollWod:a("./src/roller").rollWod,parseAndRoll:a("./src/complex/parseAndRoll"),parseAndRollSimple:a("./src/complex/parseAndRollSimple"),parseAndRollClassic:a("./src/complex/parseAndRollClassic"),parseAndRollWod:a("./src/complex/parseAndRollWod"),random:a("./src/random").randomRoll,convert:a("./src/converter").convertToAnyRoll}},{"./src/complex/parse":2,"./src/complex/parseAndRoll":3,"./src/complex/parseAndRollClassic":4,"./src/complex/parseAndRollSimple":5,"./src/complex/parseAndRollWod":6,"./src/complex/parseClassicRoll":7,"./src/complex/parseSimpleRoll":8,"./src/complex/parseWodRoll":9,"./src/converter":10,"./src/object/Result":14,"./src/object/Roll":15,"./src/object/WodRoll":17,"./src/random":19,"./src/roller":20}],2:[function(a,b){const{parseAny:c}=a("../parser"),{mapToRoll:d,mapToWodRoll:e}=a("../mapper"),f=a("../object/Type");b.exports=function(a){const b=c(a),g=b?b.type:"";return g===f.simple?d(b):g===f.classic?d(b):g===f.wod?e(b):null}},{"../mapper":12,"../object/Type":16,"../parser":18}],3:[function(a,b){const{rollAny:c}=a("../roller"),d=a("./parse");b.exports=(a)=>c(d(a))},{"../roller":20,"./parse":2}],4:[function(a,b){const{rollClassic:c}=a("../roller"),d=a("./parseClassicRoll");b.exports=(a)=>c(d(a))},{"../roller":20,"./parseClassicRoll":7}],5:[function(a,b){const{rollClassic:c}=a("../roller"),d=a("./parseSimpleRoll");b.exports=(a)=>c(d(a))},{"../roller":20,"./parseSimpleRoll":8}],6:[function(a,b){const{rollWod:c}=a("../roller"),d=a("./parseWodRoll");b.exports=(a)=>c(d(a))},{"../roller":20,"./parseWodRoll":9}],7:[function(a,b){const{parseClassic:c}=a("../parser"),{mapToRoll:d}=a("../mapper");b.exports=(a)=>d(c(a))},{"../mapper":12,"../parser":18}],8:[function(a,b){const{parseSimple:c}=a("../parser"),{mapToRoll:d}=a("../mapper");b.exports=(a)=>d(c(a))},{"../mapper":12,"../parser":18}],9:[function(a,b){const{parseWod:c}=a("../parser"),{mapToWodRoll:d}=a("../mapper");b.exports=(a)=>d(c(a))},{"../mapper":12,"../parser":18}],10:[function(a,b){function c(a={}){const{dice:b,count:c,modifier:d}=a||{};return new f(b,c,d)}function d(a={}){const{dice:b,count:c,again:d,success:e,fail:f}=a||{};return new g(b,c,d,e,f)}const{isAbsent:e}=a("./normalizer"),f=a("./object/Roll"),g=a("./object/WodRoll");b.exports={convertToRoll:c,convertToWodRoll:d,convertToAnyRoll:function(a={}){const{again:b,success:f,fail:g}=a||{};return e(b)&&e(f)&&e(g)?c(a):d(a)}}},{"./normalizer":13,"./object/Roll":15,"./object/WodRoll":17}],11:[function(a,b){b.exports={simple:[/^(\d+)(?:\s+(\d+)(?:\s+([+-]?\d+))?)?$/],classic:[/^(\d*)(?:[dD])(\d+)([+-]\d+)?$/],wod:[/^(\d*)(?:[dD])(\d+)(!?)$/,/^(\d*)(?:[dD])(\d+)(!?)(?:>)(\d+)(?:f(\d+))?$/]}},{}],12:[function(a,b){function c(a){const b=!a||2>a.length;return b?null:a.slice(1).map(d)}const{normalizeRegexResult:d,isAbsent:e}=a("./normalizer"),f=a("./object/Roll"),g=a("./object/WodRoll"),h=(a)=>(b)=>{if(!b||0===b.length)return null;const c=1===b.length||b.slice(1).every(e);return c?[b[0]]:[b[1],b[0],...b.slice(2,a)]},i=h(3),j=h(5);b.exports={map:c,orderArguments:h,mapToRoll:(a)=>{const b=i(c(a));return b?new f(...b):null},mapToWodRoll:(a)=>{const b=j(c(a));return b?new g(...b):null}}},{"./normalizer":13,"./object/Roll":15,"./object/WodRoll":17}],13:[function(a,b){var c=Math.min,d=Number.isInteger;const e=(a)=>d(a)&&0<a,f=(a)=>(b)=>e(b)?b:a,g=f(1),h=(a)=>(b)=>c(f(Number.MAX_SAFE_INTEGER)(b),a),i=(a)=>(b)=>c(f(0)(b),a),j=(a)=>a===void 0||null===a||""===a,k=(a)=>parseInt(a,10)||a;b.exports={isAbsent:j,isDefined:(a)=>a!==void 0&&null!==a,fixInvalid:f,normalizeInteger:(a)=>d(a)?a:0,normalizeRollResult:g,normalizeTop:h,normalizeBottom:i,normalizeWodBorders:(c,d,e)=>{const f=h(e)(d),b=i(f-1)(c);return[b,f]},normalizeRegexResult:(a)=>j(a)?null:k(a)}},{}],14:[function(a,b){function c(a,b,c){this.notation=a,this.value=b,this.rolls=c}const{resultNotation:d}=a("../stringifier");c.prototype.toString=function(){return d(this)},b.exports=c},{"../stringifier":21}],15:[function(a,b){function c(a=20,b=1,c=0){this.dice=g(a),this.count=g(b),this.modifier=e(c)}const{fixInvalid:d,normalizeInteger:e}=a("../normalizer"),{classicNotation:f}=a("../stringifier"),g=d(1);c.prototype.toString=function(){return f(this)},b.exports=c},{"../normalizer":13,"../stringifier":21}],16:[function(a,b){b.exports={simple:"simple",classic:"classic",wod:"wod"}},{}],17:[function(a,b){function c(a=10,b=1,c=!1,d=6,f){this.dice=g(a),this.count=g(b),this.again=!!c,[this.fail,this.success]=e(f,d,this.dice)}const{fixInvalid:d,normalizeWodBorders:e}=a("../normalizer"),{wodNotation:f}=a("../stringifier"),g=d(1);c.prototype.toString=function(){return f(this)},b.exports=c},{"../normalizer":13,"../stringifier":21}],18:[function(a,b){const c=a("./grammar"),d=a("./object/Type"),e=(a)=>1===a.length,f=(a,b)=>{return e(a)?(c)=>{const d=a[0].exec(c);return d&&(d.type=b),d}:(c)=>{let d=null;return a.some((a)=>d=a.exec(c)),d&&(d.type=b),d}},g=f(c.simple,d.simple),h=f(c.classic,d.classic),i=f(c.wod,d.wod);b.exports={makeParser:f,parseSimple:g,parseClassic:h,parseWod:i,parseAny:(a)=>h(a)||g(a)||i(a)}},{"./grammar":11,"./object/Type":16}],19:[function(a,b){const c=(a)=>(b)=>Math.floor(Math.random()*(b+1-a))+a,d=c(1);b.exports={random:c,randomRoll:d}},{}],20:[function(a,b){function c(a){const b=a instanceof m?a:i(a),{dice:c,count:d,modifier:e}=b,h=[...Array(d)].map(()=>f(c)),j=h.reduce((a,b)=>a+b,0),k=g(j+e);return new l(b.toString(),k,h)}function d(a){const b=a instanceof n?a:j(a),{dice:c,count:d,again:e,success:g,fail:h}=b,k=[];for(let a=d;0<a;){const b=f(c);k.push(b);(b!==c||!e||k.length>100)&&(a-=1)}const i=k.reduce((a,b)=>{if(b>=g)return a+1;return b<=h?a-1:a},0);return new l(b.toString(),Math.max(i,0),k)}function e(a){if(a instanceof m)return c(a);return a instanceof n?d(a):h(a)?e(k(a)):null}const{randomRoll:f}=a("./random"),{normalizeRollResult:g,isDefined:h}=a("./normalizer"),{convertToRoll:i,convertToWodRoll:j,convertToAnyRoll:k}=a("./converter"),l=a("./object/Result"),m=a("./object/Roll"),n=a("./object/WodRoll");b.exports={rollClassic:c,rollWod:d,rollAny:e}},{"./converter":10,"./normalizer":13,"./object/Result":14,"./object/Roll":15,"./object/WodRoll":17,"./random":19}],21:[function(a,b){b.exports={simpleNotation:function(a){const b=1<a.count?`${a.count} `:"",c=a.modifier?` ${a.modifier}`:"";return`${b}${a.dice}${c}`},classicNotation:function(a){const b=1<a.count?a.count:"",c=0<a.modifier?`+${a.modifier}`:a.modifier||"";return`${b}d${a.dice}${c}`},wodNotation:function(a){const b=1<a.count?a.count:"",c=a.again?"!":"",d=0<a.fail?`f${a.fail}`:"";return`${b}d${a.dice}${c}>${a.success}${d}`},resultNotation:function(a){const{notation:b,value:c,rolls:d}=a;return`(${b}) ${c} [${d}]`}}},{}]},{},[1])(1)});
